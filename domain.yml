version: "3.0"

intents:
  - chitchat:
      is_retrieval_intent: true
  - affirm
  - deny
  - extract_kpi
  - mood_unhappy
  - faq:
      is_retrieval_intent: true
  - request_kpi_form


entities:
- place
- kpi
- DATE

slots:
  place:
    type: text
    influence_conversation: true
    mappings:
    - type: from_entity
      entity: place
      # conditions:
      # - active_loop: kpi_form
      #   requested_slot: place   
  kpi:
    type: text
    influence_conversation: true
    mappings:
    - type: from_entity
      entity: kpi

  DATE:
    type: text
    influence_conversation: true
    mappings:
    - type: from_entity
      entity: DATE

  mapped_time: 
    type: text
    initial_value: None
    mappings:
    - type: custom

forms:
  kpi_form:
    required_slots:
      - place
      - kpi
      - DATE


responses:
  utter_ask_place:
  - text: "Which place are you interested in?"

  utter_ask_kpi:
  - text: "Which KPI are you interested in?"

  utter_ask_DATE:
  - text: "What time are you interested?"

  utter_state_sql:
  - text: "SELECT SUM({kpi}) FROM \"E-Mobility\".emo_historical WHERE state='{place}' AND month={time};"

  utter_state_city_sql:
  - text: "SELECT {kpi} FROM \"E-Mobility\".emo_historical WHERE state='{place}' AND month={time};"

  utter_county_sql:
  - text: "SELECT {kpi} FROM \"E-Mobility\".emo_historical WHERE county='{place}' AND month={time};"

  utter_query_received:
  - text: "Ok, query received. Please confirm the following."

  utter_query_confirm:
  - text: "the place is {place}, kpi is {kpi}, time is {time}"

  utter_query_completed:
  - text: "Query now in process..."

  utter_ask_for_clarification:
  - text: "Please correct the false part."
  
  utter_chitchat/greet:
  - text: "hi"
  - text: "hello"
  utter_chitchat/goodbye:
  - text: "goodbye"
  - text: "bye"

  utter_faq/service:
  - text: "KPIs that are available: Locations, Charging stations, Charging points, Charging points per 1,000 cars, Cars per charging point, Percentage of target.//You can type the KPI name for the KPI description or start directly asking me questions regarding the KPI within Germany."

  utter_faq/locations_info:
  - text: "locations: number of charging infrastructure places."

actions:
  - utter_ask_place
  - utter_ask_time
  - utter_ask_kpi
  - action_query_clarify
  - action_reset_slots
  - action_query_confirm
  - action_execute_query
  - action_convert_date

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true
